<script type="text/javascript">
  $.validate();
</script>
  <div class="row-fluid">
    <div class="span12">
      <h2 class="page-title">
        KRA
        <br>
        <small>
          <div class="search-result">
            <p style="text-align:justify;font-size:80%" class="span8">
              Goals should be SMARTER = Specific, Measurable, Achievable, Result-Oriented, Time-Bound, Engaging, Reaching.   Performance Planning is facilitated by first listing the Key Responsibilities of the position and then defining Objectives and Goals for each Key Responsibility.                                                           
            </p>
          </div>
        </small>
      </h2>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span8">
      <section class="widget">
        <header>
          <h4>
            <i class="eicon-lamp">
            </i>
            Key Result Areas Rating &amp; Comments
          </h4>
        </header>
        <div class="body">
          <table class="table table-striped table-images">
            <thead>
              <tr>
                <th>
                  KEY RESULT AREAS
                </th>
                <th>
                  MEASURES
                </th>
                <% if current_user.role == "appraisee" %>
                  <th class="hidden-phone">
                    SELF RATING &amp; COMMENTS
                    </th>
                    <% end %>
                 <% if current_user.role == "appraiser" %>
                   <th class="hidden-phone">
                      MANAGER'S RATING
                   </th>
                   <% end %>
                   <th>
                   </th>
                   </tr>
                   </thead>
                   <tbody>
                     <% for kra_attr in @kra_rating.find_kra_attrs_for_role(current_user.id) do%>
                       <tr>
                         <td style="text-align:justify;font-size:80%">
                           <p class="page-title">
                             <%= kra_attr.name %>
                              <br>
                              <small class="offset1">
                                    WEIGHTAGE: 
                                    <span class="badge">
                                      <%= kra_attr.weightage %>
                                      </span>
                              </small>
                           </p>
                           <%= kra_attr.desc %>
                         </td>
                         <td style="text-align:justify;font-size:80%">
                           <small>
                             <%= kra_attr.measures %>
                           </small>
                         </td>
                         <% if (current_user.role == 'appraisee dnt wrk'|| current_user.role == 'appraiser dnt wrk') && @flag == nil %>
                           <td>
                             <%= form_for(@kra_rating, :remote => true) do |f|  %>
                               <%= f.hidden_field :kra_sheet_id, :value => "#{@kra_rating.find_kra_sheet_self(current_user.id)}" %>
                               <%= f.hidden_field :kra_attr_id, :value => "#{kra_attr.id}" %>
                               <%= f.hidden_field :rated_by, :value => 0 %>
                               <section class="widget">
                                 <span id=<%= "self-rating_#{kra_attr.id}" %> >
                                 </span>
                                 <% rating_val = kr_attr_rating(@kra_rating.find_kra_sheet_self(current_user.id),kra_attr.id,0)  %>
                                 <% rating_comment = kr_attr_comment(@kra_rating.find_kra_sheet_self(current_user.id),kra_attr.id,0)  %>

                                 <h1><%= "#{@kr_atr_rating}"  %></h1>
                                 <% if kr_attr_rating(@kra_rating.find_kra_sheet_self(current_user.id),kra_attr.id,0) != nil then %>
                                   <h1>HELLO</h1>
                                   <p><%= rating_val %></p>
                                <% else%>
                                  <%= f.text_field :rating,:style =>"width: 20px", :id => "self-result_#{kra_attr.id}",  :value =>0, :class => "btn btn-success search-query"%>
                                <% end %>
                                <% unless rating_comment.nil? then %>
                                  <%= f.text_area :comment, :class => "elastic-textarea autogrow input-block-level", :placeholder => "Commetnts", :rows =>"5", :id =>"self-cmt_#{kra_attr.id}", :value => rating_comment  %>
                                <% else %>
                                  <%= f.text_area :comment, :class => "elastic-textarea autogrow input-block-level", :placeholder => "Commetnts", :rows =>"5", :id =>"self-cmt_#{kra_attr.id}"  %>
                                <% end %>
                                 <%= f.submit "Save", :class => "btn btn-primary", :onclick => "this.disabled=true; this.value='Saved'; $('#self-rating_#{kra_attr.id}').hide(); $('#self-cmt_#{kra_attr.id}').hide(); " %>
                               </section>
                             <% end %>
                           </td>
                         <%end%>
                         <% if current_user.role == "appraiser"  then  %>
                            <td>
                              <%= form_for(@kra_rating, :remote =>
                                true ) do |f|  %>
                                <%= f.hidden_field :kra_sheet_id, :value =>
                                  "#{@kra_rating.find_kra_sheet_manager(current_user.id,@appraisee_id)}" %>
                                  <%= f.hidden_field :kra_attr_id, :value =>
                                    "#{kra_attr.id}" %>
                                    <%= f.hidden_field :rated_by, :value =>
                                      1 %>
                                      <section class="widget">
                                        <span id='<%= "manager-rating_#{kra_attr.id}" %>'>
                                  </span>
                                  <%= f.text_field :rating,:style =>
                                    "width: 20px", :id =>
                                    "manager-result_#{kra_attr.id}",  :value =>
                                    0, :class =>
                                    "btn btn-success search-query" %>
                                        <%= f.text_area :comment, :class =>
                                          "elastic-textarea autogrow input-block-level", :placeholder => "Commetnts", :rows =>"5", :id =>"man-cmt_#{kra_attr.id}"   %>
                                    <%= f.submit "Save", class: "btn btn-primary", :onclick =>
                                      "this.disabled=true; this.value='Saved'; $('#manager-rating_#{kra_attr.id}').hide();$('#man-cmt_#{kra_attr.id}').hide();   " %>
                                    </section>
                                  </td>
                                  <%end%>
                                    <%end%>
                                    </tr>
                                    <script type="text/javascript">
                                      $('<%= "#self-rating_#{kra_attr.id}" %>').raty({
                                        path     : '/assets',
                                        cancel   : false,
                                        cancelPlace: 'right',
                                        cancelOff: 'cancel-off-big.png',
                                        cancelOn : 'cancel-on-big.png',
                                        half     : true,
                                        size     : 10,
                                        starHalf : 'star-half-big.png',
                                        starOff  : 'star-off-big.png',
                                        starOn   : 'star-on-big.png',
                                        target    : '<%= "#self-result_#{kra_attr.id}" %>',
                                        targetType: 'score',
                                        targetKeep: true,
                                        number: 10,
                                        mouseover: function(score, evt) {
                                          document.getElementById('<%= "self-result_#{kra_attr.id}" %>').value=score;
                                        }
                                        ,
                                        mousemove: function(score, evt) {
                                          document.getElementById('<%= "self-result_#{kra_attr.id}" %>').value=score;
                                        }
                                        ,
                                        hover: function(score, evt) {
                                          document.getElementById('<%= "self-result_#{kra_attr.id}" %>').value=score;
                                        }
                                      }     );
                                      $('<%= "#manager-rating_#{kra_attr.id}" %>').raty({
                                        path     : '/assets',
                                        cancel   : false,
                                        cancelOff: 'cancel-off-big.png',
                                        cancelOn : 'cancel-on-big.png',
                                        half     : true,
                                        size     : 24,
                                        starHalf : 'star-half-big.png',
                                        starOff  : 'star-off-big.png',
                                        starOn   : 'star-on-big.png',
                                        target    : '<%= "#manager-result_#{kra_attr.id}" %>',
                                        targetType: 'score',
                                        targetKeep: true,
                                        number: 10,
                                        mouseover: function(score, evt) {
                                          document.getElementById('<%= "manager-result_#{kra_attr.id}" %>').value=score;
                                        }
                                        ,
                                        mousemove: function(score, evt) {
                                          document.getElementById('<%= "manager-result_#{kra_attr.id}" %>').value=score;
                                        }
                                      }
                                                                                       );
                                    </script>
                                    <%end%>
                                    </tbody>
                                  </table>
                                  <div class="clearfix">
                                    <div class="pull-right">
                                      <button class="btn btn-small">
                                        Send to ...
                                      </button>
                                      <div class="btn-group">
                                        <button class="btn btn-small btn-inverse dropdown-toggle" data-toggle="dropdown">
                                          &nbsp; Clear &nbsp;
                                          <i class="icon-caret-down">
                                          </i>
                                        </button>
                                        <ul class="dropdown-menu">
                                          <li>
                                            <a href="#">
                                              Clear
                                            </a>
                                          </li>
                                          <li>
                                            <a href="#">
                                              Move ...
                                            </a>
                                          </li>
                                          <li>
                                            <a href="#">
                                              Something else here
                                            </a>
                                          </li>
                                          <li class="divider">
                                          </li>
                                          <li>
                                            <a href="#">
                                              Separated link
                                            </a>
                                          </li>
                                        </ul>
                                      </div>
                                    </div>
                                    
                                  </div>
                                  
                              </section>
                            </div>
                            </div>
                            
                            
